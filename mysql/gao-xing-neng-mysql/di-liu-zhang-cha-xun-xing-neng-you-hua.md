# 第六章 查询性能优化

查询开销的三个指标：

响应时间

扫描的行数

返回的行数





一般MySQL能够使用如下三种方式应用WHERE条件。从好到坏

1 在索引中使用WHERE条件来过滤不匹配的记录。这是在存储引擎层完成的。

2 使用索引覆盖扫描（在Extra列中出现Using index）来返回记录，直接从索引过滤不需要的记录并返回命中的结果。这是在MySQL服务器层完成的，但无须再回表查询记录。

3 从数据表中返回数据，然后过滤不满足条件的记录（在Extra列中出现Using where）。这在MySQL服务器层完成，MySQL需要先在数据表中读出记录然后过滤。



MySQL客户端和服务器之间的通信协议是半双工的，这意味着，在同一时刻，要么是服务器向客户端发送数据，要么是客户端向服务器发送数据，这两个动作不能同时发生。



#### **查询缓存**

MySQL会优先检查这个查询是否命中查询缓存中的数据。这个检查是通过一个队大小写敏感的哈希查找实现的。查询和缓存中的查询即使只有一个字节不同，也不会匹配缓存结果。



#### 查询优化器

优化器的作用是找出其中最好的执行计划。

MySQL能够处理的优化类型

重新定义关联表的顺序：数据表的关联并不总是安装查询中指定的顺序进行。决定关联的顺序是优化器很重要的一部分功能。

将外连接转化成内连接：并不是所有的OUTER JOIN语句都必须以外连接的方式执行。例如WHERE条件，库表结构都可能让外连接等价于一个内连接。MySQL可以识别这点并重写查询，让其可以调整关联顺序。

使用等价变换规则：MySQL可以使用一些等价变换来简化并规范表达式。它可以合并和减少一些比较，还可以移除一些恒成立或恒不成立的判断。如5=5 and a&gt;5改写成a&gt;5。

优化COUNT\(\) MIN\(\) MAX\(\)：索引河列是否为空通常可以帮助优化这类表达式。例如，要找到某一列的最小值，只需要查询对比B-TREE索引最左端的记录，MySQL可以直接获取索引的第一行记录。类似的，没有任何WHERE条件的COUNT\(\*）查询通常也可以使用存储引擎提供的一些优化。

预估并转化为参数表达式：



